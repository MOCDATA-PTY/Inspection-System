<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test KM and Hours Functions</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-container { max-width: 600px; margin: 0 auto; }
        .test-input { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .test-button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Test KM and Hours Functions</h1>
        
        <div>
            <h3>Test Input Fields</h3>
            <input type="number" class="test-input" id="kmInput" data-group-id="test-group-1" 
                   placeholder="Enter kilometers" onchange="testUpdateGroupKmTraveled(this)" 
                   onblur="testUpdateGroupKmTraveled(this)">
            
            <input type="number" class="test-input" id="hoursInput" data-group-id="test-group-1" 
                   placeholder="Enter hours" onchange="testUpdateGroupHours(this)" 
                   onblur="testUpdateGroupHours(this)">
        </div>
        
        <div>
            <h3>Test Results</h3>
            <div id="testResults"></div>
        </div>
        
        <div>
            <button class="test-button" onclick="runTests()">Run Function Tests</button>
        </div>
    </div>

    <script>
        // Test functions
        function testUpdateGroupKmTraveled(input) {
            const result = document.getElementById('testResults');
            try {
                if (typeof updateGroupKmTraveled === 'function') {
                    updateGroupKmTraveled(input);
                    result.innerHTML = '<div class="result success">✅ updateGroupKmTraveled function called successfully!</div>';
                } else {
                    result.innerHTML = '<div class="result error">❌ updateGroupKmTraveled function is not defined</div>';
                }
            } catch (error) {
                result.innerHTML = '<div class="result error">❌ Error calling updateGroupKmTraveled: ' + error.message + '</div>';
            }
        }
        
        function testUpdateGroupHours(input) {
            const result = document.getElementById('testResults');
            try {
                if (typeof updateGroupHours === 'function') {
                    updateGroupHours(input);
                    result.innerHTML = '<div class="result success">✅ updateGroupHours function called successfully!</div>';
                } else {
                    result.innerHTML = '<div class="result error">❌ updateGroupHours function is not defined</div>';
                }
            } catch (error) {
                result.innerHTML = '<div class="result error">❌ Error calling updateGroupHours: ' + error.message + '</div>';
            }
        }
        
        function runTests() {
            const result = document.getElementById('testResults');
            let testResults = '<h4>Function Availability Tests:</h4>';
            
            // Test function availability
            const functions = ['updateGroupKmTraveled', 'updateGroupHours', 'getCSRFToken'];
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    testResults += '<div class="result success">✅ ' + funcName + ' is available</div>';
                } else {
                    testResults += '<div class="result error">❌ ' + funcName + ' is not available</div>';
                }
            });
            
            // Test CSRF token
            try {
                if (typeof getCSRFToken === 'function') {
                    const token = getCSRFToken();
                    testResults += '<div class="result success">✅ getCSRFToken returns: ' + (token || 'empty') + '</div>';
                } else {
                    testResults += '<div class="result error">❌ getCSRFToken is not available</div>';
                }
            } catch (error) {
                testResults += '<div class="result error">❌ Error calling getCSRFToken: ' + error.message + '</div>';
            }
            
            result.innerHTML = testResults;
        }
        
        // Load the main JavaScript file
        const script = document.createElement('script');
        script.src = '/static/current_rendered_js.js';
        script.onload = function() {
            console.log('Main JavaScript file loaded');
            runTests();
        };
        script.onerror = function() {
            console.error('Failed to load main JavaScript file');
            document.getElementById('testResults').innerHTML = '<div class="result error">❌ Failed to load main JavaScript file</div>';
        };
        document.head.appendChild(script);
    </script>
</body>
</html>