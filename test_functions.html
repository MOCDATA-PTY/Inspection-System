<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Function Test - Kilometers and Hours</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .input-group {
            margin: 10px 0;
        }
        label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        input {
            padding: 5px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .totals {
            background-color: #f0f8ff;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Function Test: Kilometers and Hours Calculator</h1>
    
    <div class="test-section">
        <h2>Test Input Fields</h2>
        <div class="input-group">
            <label>Group 1 KM:</label>
            <input type="number" class="group-km-input" data-group-id="group_1" 
                   placeholder="0.0" step="0.1" min="0" 
                   onchange="updateGroupKmTraveled(this)" onblur="updateGroupKmTraveled(this)">
        </div>
        <div class="input-group">
            <label>Group 1 Hours:</label>
            <input type="number" class="group-hours-input" data-group-id="group_1" 
                   placeholder="0.0" step="0.1" min="0" 
                   onchange="updateGroupHours(this)" onblur="updateGroupHours(this)">
        </div>
        
        <div class="input-group">
            <label>Group 2 KM:</label>
            <input type="number" class="group-km-input" data-group-id="group_2" 
                   placeholder="0.0" step="0.1" min="0" 
                   onchange="updateGroupKmTraveled(this)" onblur="updateGroupKmTraveled(this)">
        </div>
        <div class="input-group">
            <label>Group 2 Hours:</label>
            <input type="number" class="group-hours-input" data-group-id="group_2" 
                   placeholder="0.0" step="0.1" min="0" 
                   onchange="updateGroupHours(this)" onblur="updateGroupHours(this)">
        </div>
    </div>
    
    <div class="test-section totals">
        <h2>Calculated Totals</h2>
        <div id="total-kilometers">0.0 km</div>
        <div id="total-hours">0.0 hours</div>
        <button onclick="updateTotalsDisplay()">Recalculate Totals</button>
    </div>
    
    <div class="test-section">
        <h2>Function Tests</h2>
        <button onclick="runFunctionTests()">Run All Tests</button>
        <div id="test-results"></div>
    </div>
    
    <input type="hidden" name="csrfmiddlewaretoken" value="test-csrf-token">
    
    <script src="current_rendered_js.js"></script>
    
    <script>
        // Mock CSRF token function for testing
        function getCSRFToken() {
            return 'test-csrf-token';
        }
        
        // Mock fetch function for testing
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            console.log('[MOCK FETCH]', url, options);
            return Promise.resolve({
                json: () => Promise.resolve({ success: true, message: 'Mock success' })
            });
        };
        
        function runFunctionTests() {
            const resultsDiv = document.getElementById('test-results');
            let results = '<h3>Test Results:</h3>';
            
            // Test 1: Check if functions exist
            results += '<div class="' + (typeof updateGroupKmTraveled === 'function' ? 'success' : 'error') + '">';
            results += '✓ updateGroupKmTraveled function: ' + (typeof updateGroupKmTraveled === 'function' ? 'EXISTS' : 'MISSING') + '</div>';
            
            results += '<div class="' + (typeof updateGroupHours === 'function' ? 'success' : 'error') + '">';
            results += '✓ updateGroupHours function: ' + (typeof updateGroupHours === 'function' ? 'EXISTS' : 'MISSING') + '</div>';
            
            results += '<div class="' + (typeof calculateTotalKilometers === 'function' ? 'success' : 'error') + '">';
            results += '✓ calculateTotalKilometers function: ' + (typeof calculateTotalKilometers === 'function' ? 'EXISTS' : 'MISSING') + '</div>';
            
            results += '<div class="' + (typeof calculateTotalHours === 'function' ? 'success' : 'error') + '">';
            results += '✓ calculateTotalHours function: ' + (typeof calculateTotalHours === 'function' ? 'EXISTS' : 'MISSING') + '</div>';
            
            results += '<div class="' + (typeof updateTotalsDisplay === 'function' ? 'success' : 'error') + '">';
            results += '✓ updateTotalsDisplay function: ' + (typeof updateTotalsDisplay === 'function' ? 'EXISTS' : 'MISSING') + '</div>';
            
            // Test 2: Test calculation functions
            if (typeof calculateTotalKilometers === 'function') {
                const totalKm = calculateTotalKilometers();
                results += '<div class="success">✓ Total KM calculation: ' + totalKm.toFixed(1) + ' km</div>';
            }
            
            if (typeof calculateTotalHours === 'function') {
                const totalHours = calculateTotalHours();
                results += '<div class="success">✓ Total Hours calculation: ' + totalHours.toFixed(1) + ' hours</div>';
            }
            
            // Test 3: Test validation
            results += '<h4>Validation Tests:</h4>';
            const testInput = document.createElement('input');
            testInput.setAttribute('data-group-id', 'test-group');
            testInput.value = '-5';
            
            try {
                updateGroupKmTraveled(testInput);
                results += '<div class="success">✓ Negative value validation working</div>';
            } catch (e) {
                results += '<div class="error">✗ Validation error: ' + e.message + '</div>';
            }
            
            resultsDiv.innerHTML = results;
        }
        
        // Auto-run tests when page loads
        window.addEventListener('load', function() {
            setTimeout(runFunctionTests, 1000);
        });
    </script>
</body>
</html>